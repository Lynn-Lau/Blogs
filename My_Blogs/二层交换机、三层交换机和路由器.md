### 二层交换机、三层交换机和路由器

最近在学习计算机网络，除此之外还要在设备上配置一些网络环境，在使用H3C的无线控制引擎和交换引擎一体的AC时候遇到很多问题。在官方给的所有案例、教程中，首先要做的就是建立一个VLAN，然后在去配置其他动作。然后就是还要去寻找，二层接口，三层接口之类的各种接口，这些术语在计算机网络学习中很少遇到，所以一开始就蒙圈了，今天先总结一些什么是二层交换机，三层交换机和路由器，以及它们的区别。

#### 二层交换机

二层交换机工作在OSI模型的第二层，数据链路层，所以称为二层交换机。

二层交换技术是发展比较成熟，二层交换机属数据链路层设备，可以识别数据包中的MAC地址信息，根据MAC地址进行转发，并将这些MAC地址与对应的端口记录在自己内部的一个地址表中。

![Switch Table](https://lynnlaulsl.files.wordpress.com/2016/11/switch.png)

转发过程如下：

1. 当交换机从某个端口收到一个数据包，它先读取包头中的源MAC地址，这样它就知道源MAC地址的机器是连在哪个端口上；
2. 再去读取包头中的目的MAC地址，并在地址表中查找相应的端口；
3. 如表中有与这目的MAC地址对应的端口，把数据包直接复制到这端口上；

#### 三层交换机

三层交换机使用了三层交换技术。三层交换技术就是：二层交换技术＋三层转发技术，三层交换机具有部分路由功能。三层交换技术解决了局域网中网段划分之后，网段中子网必须依赖路由进行管理的局面，解决了传统路由的低速，复杂造成的网络瓶颈问题。

在三层交换机中，第一个数据流进行路由后，它将会产生一个MAC地址与IP地址的映射表，当同样的数据流再次通过时，将根据此表直接从二层通过而不是再次路由，从而消除了路由器进行路由选择而造成网络的延迟，提高了数据包转发的效率。

三层交换原理：

> 假设两个使用IP协议的站点A、B通过第三层交换机进行通信，发送站点A在开始发送时，把自己的IP地址与B站的IP地址比较，判断B站是否与自己在同一子网内。若目的站B与发送站A在同一子网内，则进行二层的转发。若两个站点不在同一子网内，如发送站A要与目的站B通信，发送站A要向“缺省网关”发出ARP(地址解析)封包，而“缺省网关”的IP地址其实是三层交换机的三层交换模块。当发送站A对“缺省网关”的IP地址广播出一个ARP请求时，如果三层交换模块在以前的通信过程中已经知道B站的MAC地址，则向发送站A回复B的MAC地址。否则三层交换模块根据路由信息向B站广播一个ARP请求，B站得到此ARP请求后向三层交换模块回复其MAC地址，三层交换模块保存此地址并回复给发送站A,同时将B站的MAC地址发送到二层交换引擎的MAC地址表中。从这以后，当A向B发送的数据包便全部交给二层交换处理，信息得以高速交换。由于仅仅在路由过程中才需要三层处理，绝大部分数据都通过二层交换转发，因此三层交换机的速度很快，接近二层交换机的速度，同时比相同路由器的价格低很多。

#### 路由器

传统地，路由器工作于OSI七层协议中的第三层，其主要任务是接收来自一个网络接口的数据包，根据其中所含的目的地址，决定转发到下一个目的地址。因此，路由器首先得在转发路由表中查找它的目的地址，若找到了目的地址，就在数据包的帧格前添加下一个MAC地址，同时IP数据包头的TTL（Time To Live）域也开始减数，并重新计算校验和。当数据包被送到输出端口时，它需要按顺序等待，以便被传送到输出链路上。

![Router](https://lynnlaulsl.files.wordpress.com/2016/11/router.gif)

路由器在工作时能够按照某种路由通信协议(OSPF协议，BGP协议等)查找设备中的路由表。如果到某一特定节点有一条以上的路径，则基本预先确定的路由准则是选择最优（或最经济）的传输路径。由于各种网络段和其相互连接情况可能会因环境变化而变化，因此路由情况的信息一般也按所使用的路由信息协议的规定而定时更新。

#### 二层交换机和路由器的区别

传统交换机从网桥发展而来，属于OSI第二层即数据链路层设备，它根据MAC地址寻址，通过站表选择路由，站表的建立和维护由交换机自动进行。路由器属于OSI第三层即网络层设备，它根据IP地址进行寻址，通过路由表路由协议产生。

#### 三层交换机和路由器的区别

三层交换机既具有路由功能，根据IP地址进行数据转发，又具有二层转发功能，根据MAC地址进行转发，但是路由控制功能较弱，二层转发功能较强。路由器，只具有根据IP地址进行选路的功能，数据转发较慢，但是控制能力较强。

它们之间还有更多的区别在此不在多介绍。